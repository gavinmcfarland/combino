# Plugin Transform Hook Examples

This example demonstrates how to use the new plugin transform hook system in Combino, which replaces the old `onFileProcessed` hook.

## Overview

The plugin transform hook system allows you to:

- Transform file content after template processing
- Change file paths dynamically
- Add conditional processing based on file content or data
- Chain multiple transformations together

## Examples

### 1. Basic Transform Hook

Add a timestamp comment to processed files:

```javascript
const ejsWithTransform = ejs(
    { patterns: ["*.ejs", "*.js"] },
    async (context) => {
        const comment = `// Processed by EJS plugin at ${new Date().toISOString()}\n`;
        return {
            content: comment + context.content,
            targetPath: context.targetPath,
        };
    },
);
```

### 2. File Extension Transformation

Change file extensions during processing:

```javascript
const handlebarsWithTransform = handlebars(
    { patterns: ["*.hbs"] },
    async (context) => {
        const newPath = context.targetPath.replace(/\.hbs$/, ".html");
        const metadata = `<!-- Generated from ${context.sourcePath} -->\n`;
        return {
            content: metadata + context.content,
            targetPath: newPath,
        };
    },
);
```

### 3. Conditional Transform

Only transform files that contain specific content:

```javascript
const conditionalTransform = ejs({ patterns: ["*.md"] }, async (context) => {
    if (context.content.includes("{{")) {
        const note = `<!-- This file was processed by the conditional transform hook -->\n`;
        return {
            content: note + context.content,
            targetPath: context.targetPath,
        };
    }
    return {
        content: context.content,
        targetPath: context.targetPath,
    };
});
```

### 4. Data-Dependent Transform

Customize processing based on template data:

```javascript
const dataDependentTransform = handlebars(
    { patterns: ["*.txt"] },
    async (context) => {
        const { data } = context;

        if (data.framework === "react") {
            const reactHeader = `// React Framework: ${data.framework}\n`;
            return {
                content: reactHeader + context.content,
                targetPath: context.targetPath,
            };
        }

        return {
            content: context.content,
            targetPath: context.targetPath,
        };
    },
);
```

### 5. Combino Strip TS Plugin (Replaces onFileProcessed)

The `combinoCore` plugin provides the functionality that was previously available through the `onFileProcessed` hook:

```javascript
import { combinoCore } from "../../src/plugins/combino-plugin-strip-ts.js";

await combino.combine({
    outputDir: "output",
    include: ["templates"],
    data: {
        framework: "react",
        typescript: false, // This will trigger TypeScript stripping
        projectName: "My Awesome Project",
    },
    plugins: [
        ejs(),
        handlebars(),
        mustache(),

        // Strip TS functionality plugin (replaces onFileProcessed)
        combinoCore({
            priority: 0, // Run after template processing
        }),
    ],
});
```

The `combinoCore` plugin provides:

- **JavaScript file commenting**: Adds "Generated by Combino" comments to `.js` files
- **TypeScript stripping**: When `data.typescript` is `false`, strips TypeScript annotations from `.ts`, `.tsx`, `.vue`, and `.svelte` files
- **File extension conversion**: Automatically converts `.ts` to `.js` and `.tsx` to `.jsx` when TypeScript is stripped

## Migration from onFileProcessed

To migrate from the old `onFileProcessed` hook to the new plugin system:

### Before (Old System)

```javascript
const combino = new Combino();
await combino.combine({
    outputDir: "output",
    include: ["templates"],
    data: { typescript: false },
    onFileProcessed: async (context) => {
        // Your custom processing logic
        return modifiedContent;
    },
});
```

### After (New Plugin System)

```javascript
import { combinoCore } from "../../src/plugins/combino-plugin-strip-ts.js";

const combino = new Combino();
await combino.combine({
    outputDir: "output",
    include: ["templates"],
    data: { typescript: false },
    plugins: [
        // Your template engines
        ejs(),
        handlebars(),

        // Core functionality (includes onFileProcessed features)
        combinoCore(),

        // Or create your own custom plugin
        {
            engine: { render: () => "", hasTemplateSyntax: () => false },
            options: { priority: 0 },
            transform: async (context) => {
                // Your custom processing logic
                return {
                    content: modifiedContent,
                    targetPath: context.targetPath,
                };
            },
        },
    ],
});
```

## Plugin Priority

Plugins are processed in order of their priority (lower numbers first). The `combinoCore` plugin uses priority `0` to run after template processing but before other transformations.

## Dependencies

The `combinoCore` plugin requires the `strip-ts` package for TypeScript stripping functionality:

```bash
npm install strip-ts
```

If `strip-ts` is not installed, the plugin will gracefully skip TypeScript stripping and log a warning.
